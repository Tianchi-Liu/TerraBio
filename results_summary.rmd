---
title: "Summary of TerraBio eDNA Results"
author: "Karen Dyson"
date: "8/19/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("data_analysis.R")


```

## Biodiversity Results

Overall, we detected a total of `r totalReads` reads, describing a total of `r totalMOTU` MOTU representing `r totalUniqueTaxon` unique taxonomic groups.

TerraBio's biodiversity indicators break down into two main components: those describing _key species_ and thoese describing the entire community of insects/mammals detected.



## Key species indicators

### Key species present in our sample

We found a total of `r length(cocoaKeySpecie) + length(pastureKeySpecies)` key species in our sample (Table 1).


```{r keySpeciesTable}

knitr::kable(keySpeciesTable, 
             caption = "Table 1: Key species found in the TerraBio pilot in cocoa and pasture fields.")


```


### Biodiversity Indicator 4 (ABF-KPI-6): Number of keystone/priority species due to intervention.

We found `r length(keyInCocoaOnly)` species present in cocoa fields (intervention) that were not present in pasture (counterfactual). These species include: `r print(unique(keyInCocoaOnly), sep = ", ")`.

Additionally, we found `r length(keyInPastureOnly)`` species present in pasture not present in cocoa fields. These species include: `r print(unique(keyInPastureOnly), sep = ", ").

`r length(keyInBoth)` species were present in both cocoa and pasture fields, while we did not detect `r length(keyInNeither)` species in either location.

Of these key species, some are associated with (indicative of) either cocoa fields or pasture and the ecological conditions found there (Bakker, 2008; De Caceres et al., 2012). Of note, (Table 2).

```{r indicatorSpecies}

knitr::kable(indicatorSpecies[indicatorSpecies$frequency.sp > 0.79, ], 
             caption = "Table 2: Key species that are indicator species for either cocoa fields or pastures.",
             col.names = c("Field Type", "Species", "Frequency", "Mean Indicator Stat", "Minimum p Value", "Maximum p value"))


```

### Question 1.8: Does the number (richness) or abundance of key species change over time compared to the counterfactual?

As this pilot only included one time period, we compared the treatment to the counterfactual for this one time period. The number (richness) and abundance of key species for each plot and field is shown in Table 3. 

```{r tbSpeciesChange}

knitr::kable(tbSpeciesChange, 
             caption = "Table 3: Richness and abundance of key species found in the TerraBio pilot in cocoa and pasture fields.")

```

When comparing key species richness between cocoa fields (treatment) and pasture (counterfactuals), We found that... (Fig. 1) 


`r summary(keySpeciesCountLMER)`


```{r plotTBSpeciesCount, fig.cap="Figure 1: Key species richness by field site.", echo=FALSE}

plotTBSpeciesCount

```

When comparing key species abundance between cocoa fields (treatment) and pasture (counterfactuals), We found that... (Fig. 2). 


`r summary(keySpeciesAbundanceLMER)`


```{r plotTBSpeciesAbundance, fig.cap="Figure 2: Key species abundance (reads) by field site. Relative abundance is measured using the number of reads.", echo=FALSE}

plotTBSpeciesAbundance

```


## General species richness, abundance, and diversity questions

In addition to examining key species, or species of particular importance, we also examined the community composition of insect/mammal populations found on cocoa fields (intervention) and pastures (counterfactual).

### Question 1.5 & Biodiversity Indicator 6: Does species richness change over time compared to the counterfactual?

The mean species richness in cocoa fields was `r mean(cocoaSpeciesRichness)` species (SD = `r sd(cocoaSpeciesRichness)`), while on pastures mean species richness was `r mean(pastureSpeciesRichness)` (SD = `r sd(pastureSpeciesRichness)`). The number and abundance for all species for each plot and field is shown in Table 4.

```{r tbSpeciesChange2}

select(tbSpeciesChange, siteNames, siteField, siteType, allSpeciesRichness, allAbundance) %>% 
    knitr::kable(caption = "Table 4: Richness and abundance of key species found in the TerraBio pilot in cocoa and pasture fields.")

```

When comparing total species richness between cocoa fields (treatment) and pasture (counterfactuals), we found that... (Fig. 3) 


`r summary(allSpeciesRichnessLMER)`


```{r tbSpeciesAllCount, fig.cap="Figure 3: Total species richness by field site.", echo=FALSE}

tbSpeciesAllCount

```


### Question 1.6: Does relative abundance of species change over time compared to counterfactual?

When comparing total species abundance between cocoa fields (treatment) and pasture (counterfactuals), we found that... (Fig. 4). 

`r summary(allAbundanceLMER)`


```{r tbSpeciesAllAbundance, fig.cap="Figure 4: Total species abundance (reads) by field site. Relative abundance is measured using the number of reads.", echo=FALSE}

tbSpeciesAllAbundance

```


### Question 1.7: Are there changes in Shannon’s diversity index (and others) over time compared to the counterfactual? & Biodiversity Indicator 7: Change in biodiversity indices due to interventions.

Results from calculating multiple diversity indices/metrics for each site are shown in Table 5. Overall alpha diversity was `r alphaDiversity`, gamma diversity was `r gammaDiversity`, and beta diversity was `r betaDiversity`.

```{r diversityMetrics}

knitr::kable(diversityMetrics, caption = "Table 5: Diversity indices found in the TerraBio pilot in cocoa and pasture fields.")

```

When comparing diversity indicies between cocoa fields (treatment) and pasture (counterfactuals), we found that... (Fig. 4). 

`r summary(shannonLMER)`
`r summary(pielouLMER)`

```{r graphDiversityMetrics, fig.cap="Figure 5: Diversity metrics--SPECIFIC ADD HERE--by field site.", echo=FALSE}

    tbSpeciesChange %>%
        ggplot() +
        geom_boxplot(aes(siteField, shannon),
                     outlier.shape = NA) +
        geom_jitter(
            aes(siteField, shannon, color = siteType),
            width = 0.1,
            height = 0
        ) +
        labs(color = "Field Type", y = "Shannon Diversity", x = "Field Site Code")
    
    tbSpeciesChange %>%
        ggplot() +
        geom_boxplot(aes(siteField, pielou),
                     outlier.shape = NA) +
        geom_jitter(
            aes(siteField, pielou, color = siteType),
            width = 0.1,
            height = 0
        ) +
        labs(color = "Field Type", y = "Pielou", x = "Field Site Code")

```




# References

De Cáceres, M., Legendre, P., Wiser, S.K. and Brotons, L. 2012. Using species combinations in indicator analyses. Methods in Ecology and Evolution 3(6): 973-982.

Bakker, J.D., 2008. Increasing the utility of indicator species analysis. Journal of Applied Ecology, 45(6), pp.1829-1835.